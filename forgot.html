<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forgot Password</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet" />
  <link rel="icon" href="data:,">
  <style>
    * { box-sizing: border-box; font-family: "Poppins", sans-serif; }

    body{
      min-height: 100vh;
      margin: 0;
      display: grid;
      place-items: center;
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(110,231,255,.55), transparent 60%),
        radial-gradient(900px 500px at 90% 80%, rgba(255,214,110,.55), transparent 60%),
        linear-gradient(135deg, #f7fbff, #fff7fb);
      padding: 28px 16px;
    }

    .login-container{
      position: relative;
      perspective: 1000px;
      width: 360px;
      max-width: 92vw;
    }

    .login-card{
      position: relative;
      width: 100%;
      height: 90px;
      border-radius: 14px;
      background: linear-gradient(135deg, #6ee7ff, #ffd66e);
      border: 4px solid #111;
      box-shadow:
        10px 10px 0 #111,
        18px 18px 0 rgba(110, 231, 255, 0.25);
      cursor: pointer;
      overflow: hidden;
      transition: all .5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      transform-style: preserve-3d;
      outline: none;
    }

    .login-card:hover,
    .login-card:focus-within,
    .login-card.open{
      height: 300px;
      transform: translateZ(20px) rotateX(4deg) rotateY(-4deg);
      box-shadow:
        14px 14px 0 #111,
        28px 28px 0 rgba(255, 214, 110, 0.25),
        0 0 55px rgba(110, 231, 255, 0.55);
    }

    .login-title{
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: inherit;
      transition: all .4s ease;
      pointer-events: none;
    }

    .login-text{
      color: #111;
      font-weight: 800;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      text-shadow: 2px 2px 0 rgba(255,255,255,.45);
      transition: all .4s ease;
      text-align: center;
      padding: 0 10px;
    }

    .login-card:hover .login-text,
    .login-card:focus-within .login-text,
    .login-card.open .login-text{
      opacity: 0;
      transform: translateY(-30px) scale(.85);
    }

    .login-form{
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 22px;
      opacity: 0;
      transform: translateY(30px) scale(.88);
      transition: all .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .login-card:hover .login-form,
    .login-card:focus-within .login-form,
    .login-card.open .login-form{
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    form{
      width: 100%;
      margin: 0;
    }

    .subnote{
      width: 100%;
      font-size: 12px;
      font-weight: 700;
      color: rgba(17,17,17,.75);
      margin-bottom: 10px;
      line-height: 1.35;
    }

    .input-group{
      width: 100%;
      margin-bottom: 14px;
    }

    .login-input{
      width: 100%;
      padding: 12px 12px;
      background: rgba(255, 255, 255, 0.92);
      border: 3px solid #111;
      border-radius: 10px;
      font-weight: 700;
      color: #111;
      box-shadow: 4px 4px 0 #111;
      transition: all .25s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      font-size: 14px;
    }

    .login-input:focus{
      outline: none;
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 #111;
    }
    .login-input::placeholder{ color: #111; opacity: .55; }

    .login-btn{
      width: 100%;
      padding: 12px;
      background: #111;
      color: #fff;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      box-shadow: 4px 4px 0 rgba(17, 17, 17, 0.25);
      transition: transform .18s cubic-bezier(0.68, -0.55, 0.265, 1.55), background .18s ease, box-shadow .18s ease;
      user-select: none;
    }
    .login-btn:hover{
      transform: translate(2px, 2px);
      box-shadow: 2px 2px 0 rgba(17, 17, 17, 0.25);
      background: #2a2a2a;
    }
    .login-btn:active{ transform: translate(3px, 3px) scale(.99); }
    .login-btn:disabled{
      opacity: .65;
      cursor: not-allowed;
      transform: none;
    }
    .login-btn.pop{ animation: pressPop .22s ease; }
    @keyframes pressPop{
      0%{ transform: translate(0,0) scale(1); }
      50%{ transform: translate(2px,2px) scale(.985); }
      100%{ transform: translate(0,0) scale(1); }
    }

    .links{
      width: 100%;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
      font-size: 13px;
      font-weight: 600;
    }
    .links a{
      color: #111;
      text-decoration: none;
      border-bottom: 2px solid rgba(17,17,17,.25);
      padding-bottom: 2px;
    }
    .links a:hover{ border-bottom-color: rgba(17,17,17,.7); }

    .hint{
      width: 100%;
      margin-top: 10px;
      font-size: 12px;
      line-height: 1.4;
      min-height: 18px;
      text-align: left;
      font-weight: 700;
      color: rgba(17,17,17,.78);
    }
    .hint.ok{ color: rgba(0, 110, 70, .92); }
    .hint.bad{ color: rgba(160, 20, 20, .92); }

    .login-card::before{
      content: "";
      position: absolute;
      top: 0; left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
      transition: left .7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .login-card:hover::before,
    .login-card:focus-within::before,
    .login-card.open::before{
      left: 100%;
    }

    .login-card::after{
      content: "";
      position: absolute;
      top: -4px;
      right: -4px;
      width: 22px;
      height: 22px;
      background: #111;
      clip-path: polygon(0 0, 100% 0, 100% 100%);
      transition: all .6s ease;
    }
    .login-card:hover::after,
    .login-card:focus-within::after,
    .login-card.open::after{
      background: #6ee7ff;
    }

    .login-container::before{
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(110,231,255,.18);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: all .6s ease;
      z-index: -1;
      filter: blur(0.5px);
    }
    .login-container:hover::before{
      width: 420px;
      height: 420px;
    }

    @media (max-width: 420px){
      .login-card{ height: 86px; }
      .login-title{ height: 86px; }
      .login-card:hover,
      .login-card:focus-within,
      .login-card.open{ height: 310px; }
    }

    @media (prefers-reduced-motion: reduce){
      *{ transition: none !important; animation: none !important; }
    }
  </style>
</head>

<body>
  <div class="login-container">
    <div class="login-card" id="card" tabindex="0" aria-label="Forgot Password Card">
      <div class="login-title">
        <span class="login-text">Forgot Password</span>
      </div>

      <div class="login-form">
        <!-- ✅ ปิด popup “Please fill out this field.” -->
        <form id="forgotForm" novalidate>
          <div class="subnote">
            ใส่อีเมลที่ใช้สมัครไว้ ระบบจะส่งลิงก์สำหรับตั้งรหัสผ่านใหม่ไปให้
          </div>

          <div class="input-group">
            <input id="email" class="login-input" type="email" placeholder="Email" autocomplete="username" />
          </div>

          <button id="sendBtn" class="login-btn" type="submit">SEND RESET LINK</button>

          <div class="links">
            <a href="login.html">Back to login</a>
            <a href="register.html">Register</a>
          </div>

          <div class="hint" id="msg"></div>
        </form>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth } from "./firebase.js";
    import { sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const card  = document.getElementById("card");
    const form  = document.getElementById("forgotForm");
    const emailEl = document.getElementById("email");
    const btn   = document.getElementById("sendBtn");
    const msg   = document.getElementById("msg");

    const setMsg = (t, type="") => {
      msg.textContent = t || "";
      msg.classList.remove("ok","bad");
      if(type) msg.classList.add(type);
    };

    const setLoading = (b) => {
      btn.disabled = b;
      btn.textContent = b ? "Sending..." : "SEND RESET LINK";
    };

    function openCardFocus(){
      card.classList.add("open");
      setTimeout(()=> emailEl.focus(), 40);
    }

    // ✅ แตะการ์ดเพื่อเปิด/ปิด (มือถือ)
    card.addEventListener("click", (e)=>{
      const tag = (e.target?.tagName || "").toLowerCase();
      if(["input","button","a","label"].includes(tag)) return;
      card.classList.toggle("open");
      if(card.classList.contains("open")) openCardFocus();
    });

    // ✅ คลิกนอกกรอบ = ปิด
    document.addEventListener("click", (e)=>{
      if(!card.contains(e.target)) card.classList.remove("open");
    });

    function friendlyError(err){
      const code = err?.code || "";
      if(code === "auth/invalid-email") return "รูปแบบอีเมลไม่ถูกต้อง";
      if(code === "auth/missing-email") return "กรุณากรอกอีเมล";
      if(code === "auth/user-not-found") return "ไม่พบบัญชีนี้ในระบบ";
      if(code === "auth/too-many-requests") return "ลองใหม่ภายหลัง (ทำรายการบ่อยเกินไป)";
      if(code === "auth/network-request-failed") return "เน็ตสะดุด ลองใหม่อีกที";
      return `ส่งลิงก์ไม่สำเร็จ (${code || "unknown"})`;
    }

    async function sendLink(){
      const email = emailEl.value.trim();
      if(!email){
        setMsg("กรุณากรอกอีเมลก่อน", "bad");
        openCardFocus();
        return;
      }

      try{
        setMsg("", "");
        setLoading(true);

        btn.classList.remove("pop");
        void btn.offsetWidth;
        btn.classList.add("pop");

        await sendPasswordResetEmail(auth, email);

        setMsg("ส่งลิงก์รีเซ็ตรหัสผ่านไปที่อีเมลแล้ว ✅", "ok");
      }catch(err){
        console.error("RESET ERROR =>", err);
        setMsg(friendlyError(err), "bad");
      }finally{
        setLoading(false);
      }
    }

    form.addEventListener("submit", (e)=>{
      e.preventDefault();
      sendLink();
    });

    emailEl.addEventListener("keydown", (e)=>{
      if(e.key === "Enter") sendLink();
    });

    // เปิดการ์ดทันที (ถ้าคุณอยากให้เปิดเลย) — เอาบรรทัดนี้ออกได้
    card.classList.add("open");
    openCardFocus();
  </script>
</body>
</html>
